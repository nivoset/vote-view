---
import LocationSelector from './LocationSelector.astro';
import Position from './Position.astro';
import Candidate from './Candidate.astro';
import Platform from './Platform.astro';
import BallotMeasure from './BallotMeasure.astro';
import type { BallotData, District } from '~/types/ballot';

interface Props {
	selectedDistrict: District | null;
	ballotData: BallotData | null;
}

const { selectedDistrict, ballotData } = Astro.props;
---

<main class="container mx-auto px-4 py-8 max-w-4xl">
	<header class="mb-8">
		<h1 class="text-4xl font-bold text-gray-900 mb-2">Vote View</h1>
		<p class="text-gray-600">Find your local ballot measures and candidates</p>
	</header>

	<LocationSelector selectedDistrict={selectedDistrict} />

	{ballotData && (
		<div class="ballot-content">
			<div class="mb-6">
				<h2 class="text-2xl font-semibold text-gray-900 mb-2">
					Ballot for {ballotData.district.name}
				</h2>
			</div>

			{ballotData.positions
				.filter(pos => pos.type === "office")
				.map(position => {
					const candidates = ballotData!.candidates.filter(
						c => c.positionId === position.id
					);

					if (candidates.length === 0) return null;

					return (
						<Position
							title={position.title}
							id={position.id}
							description={position.description}
						>
							{candidates.map(candidate => (
								<Candidate name={candidate.name} id={candidate.id}>
									<Platform>
										{candidate.platform}
									</Platform>
								</Candidate>
							))}
						</Position>
					);
				})}

			{ballotData.measures.length > 0 && (
				<div class="mt-8">
					<h2 class="text-2xl font-semibold text-gray-900 mb-4">Ballot Measures</h2>
					{ballotData.measures.map(measure => (
						<BallotMeasure
							id={measure.id}
							name={measure.name}
							description={measure.description}
							text={measure.text}
						/>
					))}
				</div>
			)}
		</div>
	)}

	{!ballotData && selectedDistrict && (
		<div class="mt-8 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
			<p class="text-yellow-800">No ballot data available for this district.</p>
		</div>
	)}
</main>

